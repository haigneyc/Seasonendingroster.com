<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The League - 2025 Rosters</title>
  <style>
    :root { --bg:#0f0f10; --card:#1b1b1d; --cardHover:#252528; --text:#fff; --line:#26262a; --muted:#a0a0a8; }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg); color: var(--text);
    }

    /* ===== Top bar ===== */
    .sitebar {
      position: sticky; top: 0; z-index: 1000;
      width: 100%; backdrop-filter: blur(8px);
      background: rgba(15,15,16,0.85); border-bottom: 1px solid var(--line);
    }
    .bar-inner {
      margin: 0 auto; max-width: 1200px; padding: 12px 20px;
      display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: center;
    }
    .brand { font-size: 18px; font-weight: 700; letter-spacing:.2px; }
    .sub { font-size:12px; color: var(--muted); margin-top: 4px; }

    .tabs {
      display: inline-flex; gap: 6px; padding: 6px; border:1px solid var(--line);
      border-radius: 12px; background: #141416;
    }
    .tabs a {
      color: var(--text); text-decoration: none; font-size: 14px;
      padding: 8px 12px; border-radius: 8px; line-height: 1;
      border: 1px solid transparent; transition: background .15s ease, border-color .15s ease;
    }
    .tabs a:hover { background: var(--cardHover); border-color: var(--line); }
    .tabs a[aria-current="page"] { background: var(--card); border-color: var(--line); }

    /* ===== Page content ===== */
    .wrap { max-width: 1200px; margin: 0 auto; padding: 20px; }
    h1 { margin: 0 0 8px; font-size: 24px; }
    .hint { opacity: .85; font-size: 14px; color: var(--muted); margin-bottom: 20px; }

    /* ===== Roster Grid ===== */
    .roster-grid {
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    }

    .roster-card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 12px;
      overflow: hidden;
    }

    .roster-header {
      background: linear-gradient(135deg, #1e3a5f 0%, #2d1b4e 100%);
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .roster-header h3 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
    }

    .roster-header .team-name {
      font-size: 11px;
      color: var(--muted);
      margin-top: 2px;
    }

    .crown-badges {
      display: flex;
      gap: 2px;
      font-size: 16px;
    }

    .roster-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    .roster-table th {
      text-align: left;
      padding: 8px 12px;
      background: rgba(0,0,0,0.2);
      color: var(--muted);
      font-weight: 500;
      font-size: 11px;
      text-transform: uppercase;
    }

    .roster-table td {
      padding: 6px 12px;
      border-bottom: 1px solid var(--line);
    }

    .roster-table tr:last-child td {
      border-bottom: none;
    }

    .roster-table tr:hover {
      background: var(--cardHover);
    }

    .pos {
      display: inline-block;
      min-width: 32px;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      text-align: center;
    }

    .pos-QB { background: #c41e3a; }
    .pos-RB { background: #00ceb8; color: #000; }
    .pos-WR { background: #58a7ff; color: #000; }
    .pos-TE { background: #ffae58; color: #000; }
    .pos-K { background: #bd10e0; }
    .pos-DEF { background: #8b5a2b; }
    .pos-BN { background: #444; }
    .pos-IR { background: #666; }

    .player-team {
      color: var(--muted);
      font-size: 11px;
    }

    /* Footer */
    .site-footer {
      margin-top: 40px;
      padding: 20px;
      text-align: center;
      font-size: 12px;
      color: var(--muted);
      border-top: 1px solid var(--line);
    }
    .foot-meta { margin-top: 6px; font-size: 11px; }
  </style>
</head>
<body>
  <!-- Sticky top bar with tabs -->
  <div class="sitebar">
    <div class="bar-inner">
      <div>
        <div class="brand">Season Ending Roster</div>
        <div class="sub">2025 Season Final Rosters</div>
      </div>
      <nav class="tabs" aria-label="Primary">
        <a href="index.html" aria-current="page">Home</a>
        <a href="franchises.html">Franchises</a>
        <a href="playoffs.html">Playoffs</a>
        <a href="brackets.html">Playoff Brackets</a>
        <a href="h2h.html">Head to Head</a>
        <a href="history.html">History</a>
      </nav>
    </div>
  </div>

  <div class="wrap">
    <h1>2025 Season Ending Rosters</h1>
    <p class="hint">Final rosters for each franchise at the end of the 2025 season.</p>

    <div class="roster-grid" id="rosterGrid">
      <!-- Roster cards will be populated by JavaScript -->
      <div style="text-align: center; padding: 40px; color: var(--muted);">Loading rosters...</div>
    </div>
  </div>

  <script>
    // Franchise titles data (will be loaded from CSV)
    let titlesByOwner = {};

    // Position CSS class mapping
    const posClass = (pos) => {
      const base = pos.replace(/[^A-Z]/gi, '').toUpperCase();
      if (['QB', 'RB', 'WR', 'TE', 'K', 'DEF', 'BN', 'IR'].includes(base)) {
        return `pos-${base}`;
      }
      if (pos.includes('W/R') || pos.includes('FLEX')) return 'pos-WR';
      return 'pos-BN';
    };

    // Create roster card HTML
    function createRosterCard(team) {
      const titles = titlesByOwner[team.owner] || 0;
      const crowns = titles > 0 ? 'ðŸ‘‘'.repeat(Math.min(titles, 5)) + (titles > 5 ? ` +${titles-5}` : '') : '';

      const playersHtml = team.players.map(p => `
        <tr>
          <td><span class="pos ${posClass(p.position)}">${p.position}</span></td>
          <td>${p.name} <span class="player-team">${p.team}</span></td>
        </tr>
      `).join('');

      return `
        <div class="roster-card">
          <div class="roster-header">
            <div>
              <h3>${team.display_name}</h3>
              <div class="team-name">${team.team_name}</div>
            </div>
            ${crowns ? `<div class="crown-badges">${crowns}</div>` : ''}
          </div>
          <table class="roster-table">
            <thead>
              <tr>
                <th style="width: 50px;">Pos</th>
                <th>Player</th>
              </tr>
            </thead>
            <tbody>
              ${playersHtml}
            </tbody>
          </table>
        </div>
      `;
    }

    // Load titles from playoff_metrics.json
    async function loadTitles() {
      const paths = [
        'data/processed/playoff_metrics.json',
        '/data/processed/playoff_metrics.json'
      ];

      for (const url of paths) {
        try {
          const r = await fetch(url, {cache: 'no-store'});
          if (r.ok) {
            const data = await r.json();
            const perOwner = data.per_owner || [];
            perOwner.forEach(o => {
              titlesByOwner[o.franchise_owner] = o.titles || 0;
            });
            return;
          }
        } catch (e) {}
      }
    }

    // Load and display rosters
    async function loadRosters() {
      await loadTitles();

      const paths = [
        'site_data/rosters_2025.json',
        '/site_data/rosters_2025.json'
      ];

      let rosters = null;
      for (const url of paths) {
        try {
          const r = await fetch(url, {cache: 'no-store'});
          if (r.ok) {
            rosters = await r.json();
            break;
          }
        } catch (e) {}
      }

      const grid = document.getElementById('rosterGrid');

      if (!rosters || rosters.length === 0) {
        grid.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--muted);">No roster data available.</div>';
        return;
      }

      grid.innerHTML = rosters.map(team => createRosterCard(team)).join('');
    }

    // Initialize
    loadRosters();
    document.getElementById('footYear').textContent = new Date().getFullYear();
  </script>

  <footer class="site-footer" id="siteFoot">
    <div>Â© 2004â€“<span id="footYear"></span> Season Ending Roster</div>
    <div class="foot-meta">
      Data from Yahoo Fantasy Football API
    </div>
  </footer>
</body>
</html>
