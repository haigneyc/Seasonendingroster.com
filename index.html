<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The League - 2025 Rosters</title>
  <link rel="stylesheet" href="assets/styles.css" />
</head>
<body>
  <!-- Sticky top bar with tabs -->
  <div class="sitebar">
    <div class="bar-inner">
      <div>
        <div class="brand">Season Ending Roster</div>
        <div class="brand-sub">2025 Season Final Rosters</div>
      </div>
      <nav class="tabs" aria-label="Primary">
        <a href="index.html" aria-current="page">Home</a>
        <a href="franchises.html">Franchises</a>
        <a href="playoffs.html">Playoffs</a>
        <a href="brackets.html">Brackets</a>
        <a href="h2h.html">H2H</a>
        <a href="history.html">History</a>
      </nav>
    </div>
  </div>

  <div class="wrap">
    <div class="page-header">
      <h1>2025 Season Ending Rosters</h1>
      <p class="hint">Final rosters for each franchise at the end of the 2025 season.</p>
    </div>

    <div class="roster-grid" id="rosterGrid">
      <!-- Roster cards will be populated by JavaScript -->
      <div class="loading">Loading rosters...</div>
    </div>
  </div>

  <script>
    // Franchise titles data (will be loaded from JSON)
    let titlesByOwner = {};

    // Position CSS class mapping
    const posClass = (pos) => {
      const base = pos.replace(/[^A-Z]/gi, '').toUpperCase();
      if (['QB', 'RB', 'WR', 'TE', 'K', 'DEF', 'BN', 'IR'].includes(base)) {
        return `pos-${base}`;
      }
      if (pos.includes('W/R') || pos.includes('FLEX')) return 'pos-WR';
      return 'pos-BN';
    };

    // Create roster card HTML
    function createRosterCard(team) {
      const titles = titlesByOwner[team.owner] || 0;
      const crowns = titles > 0 ? '&#x1F451;'.repeat(Math.min(titles, 5)) + (titles > 5 ? ` +${titles-5}` : '') : '';

      const playersHtml = team.players.map(p => `
        <tr>
          <td><span class="pos ${posClass(p.position)}">${p.position}</span></td>
          <td>${p.name} <span class="player-team">${p.team}</span></td>
        </tr>
      `).join('');

      return `
        <div class="roster-card">
          <div class="roster-header">
            <div>
              <h3>${team.display_name}</h3>
              <div class="team-name">${team.team_name}</div>
            </div>
            ${crowns ? `<div class="crown-badges">${crowns}</div>` : ''}
          </div>
          <table class="roster-table">
            <thead>
              <tr>
                <th style="width: 50px;">Pos</th>
                <th>Player</th>
              </tr>
            </thead>
            <tbody>
              ${playersHtml}
            </tbody>
          </table>
        </div>
      `;
    }

    // Load titles from playoff_metrics.json
    async function loadTitles() {
      const paths = [
        'data/processed/playoff_metrics.json',
        '/data/processed/playoff_metrics.json'
      ];

      for (const url of paths) {
        try {
          const r = await fetch(url, {cache: 'no-store'});
          if (r.ok) {
            const data = await r.json();
            const perOwner = data.per_owner || [];
            perOwner.forEach(o => {
              titlesByOwner[o.franchise_owner] = o.titles || 0;
            });
            return;
          }
        } catch (e) {}
      }
    }

    // Load and display rosters
    async function loadRosters() {
      await loadTitles();

      const paths = [
        'site_data/rosters_2025.json',
        '/site_data/rosters_2025.json'
      ];

      let rosters = null;
      for (const url of paths) {
        try {
          const r = await fetch(url, {cache: 'no-store'});
          if (r.ok) {
            rosters = await r.json();
            break;
          }
        } catch (e) {}
      }

      const grid = document.getElementById('rosterGrid');

      if (!rosters || rosters.length === 0) {
        grid.innerHTML = '<div class="empty-state"><p>No roster data available.</p></div>';
        return;
      }

      grid.innerHTML = rosters.map(team => createRosterCard(team)).join('');
    }

    // Initialize
    loadRosters();
    document.getElementById('footYear').textContent = new Date().getFullYear();
  </script>

  <footer class="site-footer" id="siteFoot">
    <div>&copy; 2004&ndash;<span id="footYear"></span> Season Ending Roster</div>
    <div class="foot-meta">Data from Yahoo Fantasy Football API</div>
  </footer>
</body>
</html>
